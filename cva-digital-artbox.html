<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-60274083-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-60274083-1");
    </script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/p5.min.js"
    ></script>
    <title>CVA 10 Print</title>
    <style>
      input {
        width: 25%;
      }

      @media only screen and (max-width: 750px) {
        input {
          width: 100%;
        }
      }

      #sketch-controls {
        padding: 16px;
        background: white;
        color: black;
        margin-bottom: 12px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h3 class="center mt-0">Chester Visual Artbox</h3>
      <div id="sketch-container">
        <div id="sketch-controls">
          <span
            >Chance
            <input
              type="range"
              id="chance"
              name="chance"
              min="0.01"
              value="1"
              max="1"
              step="0.01"
            />
          </span>
          <br />
          <span
            >Control
            <input
              type="range"
              id="control"
              name="control"
              min="0"
              value="0.5"
              max="1"
              step="0.01"
            />
            <br />
            <button id="save">Save As Image</button>
          </span>
        </div>
        <div id="sketch-holder"></div>
      </div>

      <p class="center">Made with ❤️ in Chester, United Kingdom</p>
    </div>
    <script>
      let CHANCE = 1;
      let CONTROL = 0.5;

      const OPACITY = 255;
      const FRAME_RATE = 5;
      let WIDTH = document.getElementById("sketch-holder").offsetWidth;
      let HEIGHT = document.getElementById("sketch-holder").offsetHeight;
      const LINE_SIZE = 32;

      let onSliderChange = function (event) {
        switch (event.target.name) {
          case "chance":
            console.log("chance", event.target.value);
            CHANCE = event.target.value;
            break;
          case "control":
            console.log("control", event.target.value);
            CONTROL = 1 - event.target.value;
            break;
          default:
            break;
        }

        redraw();
      };

      document
        .getElementById("chance")
        .addEventListener("input", onSliderChange);
      document
        .getElementById("control")
        .addEventListener("input", onSliderChange);

      document.getElementById("save").addEventListener("click", saveSketch);

      function saveSketch() {
        console.log("save da ting");
        var canvas = document.getElementById("defaultCanvas0");
        var img = canvas.toDataURL("image/png");
        var link = document.createElement("a");
        link.id = "id";
        link.download = "10_print_sketch";
        link.href = img;
        link.click();
      }

      function again() {
        redraw();
      }

      function windowResized() {
        resizeCanvas(
          document.getElementById("sketch-holder").offsetWidth,
          document.getElementById("sketch-holder").offsetHeight
        );
      }

      function setup() {
        var canvas = createCanvas(WIDTH, HEIGHT);
        canvas.parent("sketch-holder");
        noLoop();
      }

      function draw() {
        background(color("#0f62fe"), OPACITY);
        stroke(color("white"));
        strokeWeight(6);
        smooth();
        for (var x = 0; x < WIDTH; x += LINE_SIZE) {
          for (var y = 0; y < HEIGHT; y += LINE_SIZE) {
            if (Math.random() < CHANCE) {
              if (Math.random() < CONTROL) {
                line(x, y, x + LINE_SIZE, y + LINE_SIZE);
              } else {
                line(x + LINE_SIZE, y, x, y + LINE_SIZE);
              }
            }
          }
        }
      }
    </script>
  </body>
</html>
